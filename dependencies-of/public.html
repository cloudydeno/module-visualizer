<!doctype html>
<title>Module Dependency Graph | {{ module_url }}</title>
{{ globals }}

<style type="text/css">
body {
  display: grid;
  height: 100vh;
  width: 100vw;
  margin: 0;

  grid-template-columns: 1fr;
  /*grid-template-columns: repeat(3, 1fr);*/
  grid-gap: 1em;
  grid-template-rows: auto auto 1fr;
  /*grid-auto-rows: minmax(100px, auto);*/
  grid-template-areas:
    "header"
    "form"
    "graph";
}
</style>

<header>
  <h1>Deno Module Dependency Graph</h1>
  <hgroup>
    <h2>Showing
      <a href="{{ module_url }}" target="_blank">{{ module_url }}</a>
    </h2>
    <h3>[<a href="/svg{{ current_path }}">svg</a>]</h3>
  </hgroup>
</header>

<form id="query">
  <span>Module URL:</span>
  <input type="url" name="url" class="url"
      required value="{{ module_url }}"
      placeholder="https://deno.land/x/..." pattern="https://.+" />
  <select name="rankdir">
    <option value="TB">Top-to-bottom</option>
    <option value="LR">Left-to-right</option>
  </select>
  <select name="std">
    <option value="combine">Treat /std as one module</option>
    <option value="isolate">Break /std up into subfolders</option>
  </select>
  <button type="submit">Render</button>
</form>

<script type="text/javascript">
  const form = document.querySelector('form#query');
  if (form) {
    form.style.display = 'flex';

    const args = new URLSearchParams(document.location.search);
    form.std.value = args.get('std') || 'combine';
    form.rankdir.value = args.get('rankdir') || 'TB';

    form.addEventListener('submit', evt => {
      evt.preventDefault();

      const url = new URL(evt.target.url.value);
      if (url.protocol !== 'https:') {
        return alert('Only https modules are accepted');
      }
      const modId = `https/${url.host}${url.pathname}`;

      const args = new URLSearchParams;
      if (evt.target.std.value !== 'combine') {
        args.set('std', evt.target.std.value);
      }
      if (evt.target.rankdir.value !== 'TB') {
        args.set('rankdir', evt.target.rankdir.value);
      }

      const newUrl = new URL(window.location);
      newUrl.pathname = `dependencies-of/${modId}`;
      newUrl.search = args.toString();

      window.location = newUrl.toString();
    });
  }
</script>

<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/cloudydeno/module-visualizer/tree/main/dependencies-of" class="github-corner" aria-label="View source on GitHub">{{ github_corner }}</a>

{{ graph_svg }}
